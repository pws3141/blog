<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paul Smith">
<meta name="dcterms.date" content="2025-03-03">

<title>Getting Started with {mlr3} – Paul Smith</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-39aa5599c175b676807642dbe23379f8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta name="citation_title" content="Getting Started with {mlr3}">
<meta name="citation_author" content="Paul Smith">
<meta name="citation_publication_date" content="2025-03-03">
<meta name="citation_cover_date" content="2025-03-03">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-03-03">
<meta name="citation_fulltext_html_url" content="https://pws3141.github.io/blog/posts/05-mlr3_basic_modelling/">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Clmnis: An r package for downloading data from the parliamentary members names information service;,citation_author=Noel Dempsey;,citation_publication_date=2025;,citation_cover_date=2025;,citation_year=2025;,citation_fulltext_html_url=https://github.com/houseofcommonslibrary/clmnis;">
<meta name="citation_reference" content="citation_title=Highcharter: A wrapper for the ’highcharts’ library;,citation_author=Joshua Kunst;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://CRAN.R-project.org/package=highcharter;">
<meta name="citation_reference" content="citation_title=Palmerpenguins: Palmer archipelago (antarctica) penguin data;,citation_author=Allison Marie Horst;,citation_author=Alison Presmanes Hill;,citation_author=Kristen B Gorman;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://allisonhorst.github.io/palmerpenguins/;,citation_doi=10.5281/zenodo.3960218;">
<meta name="citation_reference" content="citation_title=Medicaldata: Data package for medical datasets;,citation_author=Peter Higgins;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://CRAN.R-project.org/package=medicaldata;">
<meta name="citation_reference" content="citation_title=Fontawesome: Easily work with ’font awesome’ icons;,citation_author=Richard Iannone;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://github.com/rstudio/fontawesome;">
<meta name="citation_reference" content="citation_title=Welcome to the tidyverse;,citation_author=Hadley Wickham;,citation_author=Mara Averick;,citation_author=Jennifer Bryan;,citation_author=Winston Chang;,citation_author=Lucy D’Agostino McGowan;,citation_author=Romain François;,citation_author=Garrett Grolemund;,citation_author=Alex Hayes;,citation_author=Lionel Henry;,citation_author=Jim Hester;,citation_author=Max Kuhn;,citation_author=Thomas Lin Pedersen;,citation_author=Evan Miller;,citation_author=Stephan Milton Bache;,citation_author=Kirill Müller;,citation_author=Jeroen Ooms;,citation_author=David Robinson;,citation_author=Dana Paige Seidel;,citation_author=Vitalie Spinu;,citation_author=Kohske Takahashi;,citation_author=Davis Vaughan;,citation_author=Claus Wilke;,citation_author=Kara Woo;,citation_author=Hiroaki Yutani;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=43;,citation_doi=10.21105/joss.01686;,citation_volume=4;,citation_journal_title=Journal of Open Source Software;">
<meta name="citation_reference" content="citation_title=Paletteer: Comprehensive collection of color palettes;,citation_author=Emil Hvitfeldt;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://github.com/EmilHvitfeldt/paletteer;">
<meta name="citation_reference" content="citation_title=Gapminder: Data from gapminder;,citation_author=Jennifer Bryan;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://CRAN.R-project.org/package=gapminder;">
<meta name="citation_reference" content="citation_title=mlr3: A modern object-oriented machine learning framework in R;,citation_author=Michel Lang;,citation_author=Martin Binder;,citation_author=Jakob Richter;,citation_author=Patrick Schratz;,citation_author=Florian Pfisterer;,citation_author=Stefan Coors;,citation_author=Quay Au;,citation_author=Giuseppe Casalicchio;,citation_author=Lars Kotthoff;,citation_author=Bernd Bischl;,citation_publication_date=2019-12;,citation_cover_date=2019-12;,citation_year=2019;,citation_fulltext_html_url=https://joss.theoj.org/papers/10.21105/joss.01903;,citation_doi=10.21105/joss.01903;,citation_journal_title=Journal of Open Source Software;">
<meta name="citation_reference" content="citation_title=Applied machine learning using mlr3 in R;,citation_editor=Bernd Bischl;,citation_editor=Raphael Sonabend;,citation_editor=Lars Kotthoff;,citation_editor=Michel Lang;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://mlr3book.mlr-org.com;,citation_isbn=9781032507545;">
<meta name="citation_reference" content="citation_title=Data and basic modeling;,citation_author=Natalie Foss;,citation_author=Lars Kotthoff;,citation_editor=Bernd Bischl;,citation_editor=Raphael Sonabend;,citation_editor=Lars Kotthoff;,citation_editor=Michel Lang;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://mlr3book.mlr-org.com/data_and_basic_modeling.html;,citation_inbook_title=Applied machine learning using mlr3 in R;">
<meta name="citation_reference" content="citation_title=Factors associated with short-and long-term liver graft survival in the united kingdom: Development of a UK donor liver index;,citation_author=David Collett;,citation_author=Peter J Friend;,citation_author=Christopher JE Watson;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=4;,citation_volume=101;,citation_journal_title=Transplantation;,citation_publisher=LWW;">
<meta name="citation_reference" content="citation_title=Regression modeling strategies: With applications to linear models, logistic regression, and survival analysis;,citation_author=Frank E Harrell;,citation_author=others;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_volume=608;">
<meta name="citation_reference" content="citation_title=Estimating the residual variance in orthogonal regression with variable selection;,citation_author=JB Copas;,citation_author=Tianyong Long;,citation_publication_date=1991;,citation_cover_date=1991;,citation_year=1991;,citation_issue=1;,citation_volume=40;,citation_journal_title=Journal of the Royal Statistical Society Series D: The Statistician;,citation_publisher=Oxford University Press;">
<meta name="citation_reference" content="citation_title=Backward, forward and stepwise automated subset selection algorithms: Frequency of obtaining authentic and noise variables;,citation_author=Shelley Derksen;,citation_author=Harvey J Keselman;,citation_publication_date=1992;,citation_cover_date=1992;,citation_year=1992;,citation_issue=2;,citation_volume=45;,citation_journal_title=British Journal of Mathematical and Statistical Psychology;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Evaluation of clinical prediction models (part 1): From development to external validation;,citation_author=Gary S Collins;,citation_author=Paula Dhiman;,citation_author=Jie Ma;,citation_author=Michael M Schlussel;,citation_author=Lucinda Archer;,citation_author=Ben Van Calster;,citation_author=Frank E Harrell;,citation_author=Glen P Martin;,citation_author=Karel GM Moons;,citation_author=Maarten Van Smeden;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_volume=384;,citation_journal_title=Bmj;,citation_publisher=British Medical Journal Publishing Group;">
<meta name="citation_reference" content="citation_title=Validation in prediction research: The waste by data splitting;,citation_author=Ewout W Steyerberg;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_volume=103;,citation_journal_title=Journal of clinical epidemiology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Regression shrinkage and selection via the lasso;,citation_author=Robert Tibshirani;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_issue=1;,citation_volume=58;,citation_journal_title=Journal of the Royal Statistical Society Series B: Statistical Methodology;,citation_publisher=Oxford University Press;">
<meta name="citation_reference" content="citation_title=A package for survival analysis in r;,citation_author=Terry M Therneau;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=survival;">
<meta name="citation_reference" content="citation_title=Data.table: Extension of ‘data.frame‘;,citation_author=Tyson Barrett;,citation_author=Matt Dowle;,citation_author=Arun Srinivasan;,citation_author=Jan Gorecki;,citation_author=Michael Chirico;,citation_author=Toby Hocking;,citation_author=Benjamin Schwendinger;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=data.table;">
<meta name="citation_reference" content="citation_title=Evaluation and benchmarking;,citation_author=Giuseppe Casalicchio;,citation_author=Lukas Burk;,citation_editor=Bernd Bischl;,citation_editor=Raphael Sonabend;,citation_editor=Lars Kotthoff;,citation_editor=Michel Lang;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://mlr3book.mlr-org.com/evaluation_and_benchmarking.html;,citation_inbook_title=Applied machine learning using mlr3 in R;">
<meta name="citation_reference" content="citation_title=mlr3data: Collection of machine learning data sets for ’mlr3’;,citation_author=Marc Becker;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://github.com/mlr-org/mlr3data;">
<meta name="citation_reference" content="citation_title=mlr3measures: Performance measures for ’mlr3’;,citation_author=Michel Lang;,citation_author=Marc Becker;,citation_author=Lona Koers;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=mlr3measures;">
<meta name="citation_reference" content="citation_title=Hyperparameter optimization;,citation_author=Marc Becker;,citation_author=Lennart Schneider;,citation_author=Sebastian Fischer;,citation_editor=Bernd Bischl;,citation_editor=Raphael Sonabend;,citation_editor=Lars Kotthoff;,citation_editor=Michel Lang;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://mlr3book.mlr-org.com/hyperparameter_optimization.html;,citation_inbook_title=Applied machine learning using mlr3 in R;">
<meta name="citation_reference" content="citation_title=State of the art in selection of variables and functional forms in multivariable analysis—outstanding issues;,citation_author=Willi Sauerbrei;,citation_author=Aris Perperoglou;,citation_author=Matthias Schmid;,citation_author=Michal Abrahamowicz;,citation_author=Heiko Becher;,citation_author=Harald Binder;,citation_author=Daniela Dunkler;,citation_author=Frank E Harrell;,citation_author=Patrick Royston;,citation_author=Georg Heinze;,citation_author=others;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=4;,citation_journal_title=Diagnostic and prognostic research;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Evaluation of clinical prediction models (part 1): From development to external validation;,citation_author=Gary S Collins;,citation_author=Paula Dhiman;,citation_author=Jie Ma;,citation_author=Michael M Schlussel;,citation_author=Lucinda Archer;,citation_author=Ben Van Calster;,citation_author=Frank E Harrell;,citation_author=Glen P Martin;,citation_author=Karel GM Moons;,citation_author=Maarten Van Smeden;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_volume=384;,citation_journal_title=Bmj;,citation_publisher=British Medical Journal Publishing Group;">
</head>

<body class="floating nav-fixed slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Paul Smith</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://pws3141.github.io"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pws3141/blog"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Getting Started with {mlr3}</h1>
            <p class="subtitle lead">01 Data and Basic Modeling</p>
                                <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">r</div>
                <div class="quarto-category">machine learning</div>
                <div class="quarto-category">mlr3</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Paul Smith </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 3, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#sec-question-one" id="toc-sec-question-one" class="nav-link" data-scroll-target="#sec-question-one">Question 1</a>
  <ul class="collapse">
  <li><a href="#answer" id="toc-answer" class="nav-link" data-scroll-target="#answer">Answer</a></li>
  </ul></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a>
  <ul class="collapse">
  <li><a href="#answer-1" id="toc-answer-1" class="nav-link" data-scroll-target="#answer-1">Answer</a></li>
  </ul></li>
  <li><a href="#question-3" id="toc-question-3" class="nav-link" data-scroll-target="#question-3">Question 3</a>
  <ul class="collapse">
  <li><a href="#answer-2" id="toc-answer-2" class="nav-link" data-scroll-target="#answer-2">Answer</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#fin" id="toc-fin" class="nav-link" data-scroll-target="#fin">Fin</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>I am attempting to learn how to use <code>{mlr3}</code> <span class="citation" data-cites="lang2019mlr3">(<a href="#ref-lang2019mlr3" role="doc-biblioref">Lang et al. 2019</a>)</span>, by reading through the book <a href="https://mlr3book.mlr-org.com/">Applied Machine Learning Using mlr3 in R</a> <span class="citation" data-cites="bischl2024usingmlr3">(<a href="#ref-bischl2024usingmlr3" role="doc-biblioref">Bischl et al. 2024</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-lang2019mlr3" class="csl-entry" role="listitem">
Lang, Michel, Martin Binder, Jakob Richter, Patrick Schratz, Florian Pfisterer, Stefan Coors, Quay Au, Giuseppe Casalicchio, Lars Kotthoff, and Bernd Bischl. 2019. <span>“<span class="nocase">mlr3</span>: A Modern Object-Oriented Machine Learning Framework in <span>R</span>.”</span> <em>Journal of Open Source Software</em>, December. <a href="https://doi.org/10.21105/joss.01903">https://doi.org/10.21105/joss.01903</a>.
</div><div id="ref-bischl2024usingmlr3" class="csl-entry" role="listitem">
Bischl, Bernd, Raphael Sonabend, Lars Kotthoff, and Michel Lang, eds. 2024. <em>Applied Machine Learning Using <span class="nocase">m</span>lr3 in <span>R</span></em>. CRC Press. <a href="https://mlr3book.mlr-org.com">https://mlr3book.mlr-org.com</a>.
</div><div id="ref-foss2024data" class="csl-entry" role="listitem">
Foss, Natalie, and Lars Kotthoff. 2024. <span>“Data and Basic Modeling.”</span> In <em>Applied Machine Learning Using <span class="nocase">m</span>lr3 in <span>R</span></em>, edited by Bernd Bischl, Raphael Sonabend, Lars Kotthoff, and Michel Lang. CRC Press. <a href="https://mlr3book.mlr-org.com/data_and_basic_modeling.html">https://mlr3book.mlr-org.com/data_and_basic_modeling.html</a>.
</div></div><p>In this first blog post, I am going through the exercises given in Section 2 <span class="citation" data-cites="foss2024data">(<a href="#ref-foss2024data" role="doc-biblioref">Foss and Kotthoff 2024</a>)</span>. This involves creating a classification tree model, on the <code>PimaIndiansDiabetes2</code> (from the <code>{mlbench}</code> package), to predict whether a person has diabetes or not. No (proper) evaluation or validation is done here – that’ll be for a later post.</p>
<section id="prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="prerequisites">Prerequisites</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3viz)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datatable.print.nrows =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercises" class="level1 page-columns page-full">
<h1>Exercises</h1>
<section id="sec-question-one" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-question-one">Question 1</h2>
<p>Train a classification model with the <code>"classif.rpart"</code> learner on the Pima Indians Diabetes dataset. Do this without using <code>tsk("pima")</code>, and instead by constructing a task from the dataset in the <code>mlbench</code> package: <code>data(PimaIndiansDiabetes2, package = "mlbench")</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Missing data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Note: The dataset has <code>NA</code>s in its features. You can either rely on <code>rpart</code>’s capability to handle them internally (surrogate splits) or remove them from the initial <code>data.frame</code> using <code>na.omit()</code>.</p>
<p>The rpart algorithm has a built-in method called surrogate splits, which allows it to handle missing values without removing data. If a feature value is missing at a particular split, rpart:</p>
<ol type="1">
<li>Tries to use an alternative feature (a surrogate variable) that closely mimics the main splitting feature.</li>
<li>If no good surrogate is found, it assigns the most common class (for classification) or the mean value (for regression) within that split.</li>
</ol>
</div>
</div>
</div>
<ul>
<li>Make sure to define the <code>pos</code> outcome as the positive class.</li>
<li>Train the model on a random 80% subset of the given data and evaluate its performance with the classification error measure on the remaining data.</li>
</ul>
<section id="answer" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="answer">Answer</h3>
<p>Loading the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(PimaIndiansDiabetes2, <span class="at">package =</span> <span class="st">"mlbench"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pima <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(PimaIndiansDiabetes2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     pregnant glucose pressure triceps insulin  mass pedigree   age diabetes
        &lt;num&gt;   &lt;num&gt;    &lt;num&gt;   &lt;num&gt;   &lt;num&gt; &lt;num&gt;    &lt;num&gt; &lt;num&gt;   &lt;fctr&gt;
  1:        6     148       72      35      NA  33.6    0.627    50      pos
  2:        1      85       66      29      NA  26.6    0.351    31      neg
  3:        8     183       64      NA      NA  23.3    0.672    32      pos
  4:        1      89       66      23      94  28.1    0.167    21      neg
  5:        0     137       40      35     168  43.1    2.288    33      pos
 ---                                                                        
764:       10     101       76      48     180  32.9    0.171    63      neg
765:        2     122       70      27      NA  36.8    0.340    27      neg
766:        5     121       72      23     112  26.2    0.245    30      neg
767:        1     126       60      NA      NA  30.1    0.349    47      pos
768:        1      93       70      31      NA  30.4    0.315    23      neg</code></pre>
</div>
</div>
<p>I want to predict whether each person has diabetes, using a CART (‘classification and regression tree’).</p>
<section id="creating-a-task" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="creating-a-task">Creating a task</h4>
<p>First, I create the <code>task</code>. I am defining <code>pos</code> to be the positive class in this step. It can also be done later by setting <code>tsk_pima$positive = "pos"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tsk_pima <span class="ot">&lt;-</span> <span class="fu">as_task_classif</span>(pima, <span class="at">target =</span> <span class="st">"diabetes"</span>, <span class="at">positive =</span> <span class="st">"pos"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tsk_pima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:pima&gt; (768 x 9)
* Target: diabetes
* Properties: twoclass
* Features (8):
  - dbl (8): age, glucose, insulin, mass, pedigree, pregnant, pressure,
    triceps</code></pre>
</div>
</div>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#autoplot(tsk_pima, type = "duo") +</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(strip.text.y = element_text(angle = -0, size = 8))</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tsk_pima, <span class="at">type =</span> <span class="st">"pairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-pima-pairs" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-pima-pairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-pima-pairs-1.png" class="img-fluid figure-img" width="720">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-pima-pairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: A pairs plot of the <code>pima</code> dataset. Note that it is unbalanced, as there are more negative diabetes outcomes than positive.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s see how unbalanced the data is…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pima[, .N, by <span class="ot">=</span> <span class="st">"diabetes"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   diabetes     N
     &lt;fctr&gt; &lt;int&gt;
1:      pos   268
2:      neg   500</code></pre>
</div>
</div>
</section>
<section id="splitting-the-data" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="splitting-the-data">Splitting the data</h4>
<p>Create a split of <span class="math inline">\(80\%\)</span> training and <span class="math inline">\(20\%\)</span> test data.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>I know this is bad practice. Most of the time (see below for caveats), all the data should be used to fit the model, and then internal validation done via resampling (<em>e.g.</em> using bootstrap or cross-validation).</p>
<p>From Frank Harrell’s <a href="https://www.fharrell.com/post/split-val/">blog</a>,</p>
<blockquote class="blockquote">
<p>data splitting is an unstable method for validating models or classifiers, especially when the number of subjects is less than about 20,000 (fewer if signal:noise ratio is high). This is because were you to split the data again, develop a new model on the training sample, and test it on the holdout sample, the results are likely to vary significantly. Data splitting requires a significantly larger sample size than resampling to work acceptably well</p>
</blockquote>
<p>Also see <span class="citation" data-cites="steyerberg2018validation">Steyerberg (<a href="#ref-steyerberg2018validation" role="doc-biblioref">2018</a>)</span>.</p>
<p>To chose whether to do internal or external validation, see the <em>Biostatistics for Biomedical Research</em> <a href="https://hbiostat.org/bbr/reg.html#summary-choosing-internal-vs.-external-validation">summary</a>.</p>
</div>
</div>
<div class="no-row-height column-margin column-container"><div id="ref-steyerberg2018validation" class="csl-entry" role="listitem">
Steyerberg, Ewout W. 2018. <span>“Validation in Prediction Research: The Waste by Data Splitting.”</span> <em>Journal of Clinical Epidemiology</em> 103: 131–33.
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">52</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> <span class="fu">partition</span>(tsk_pima, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>splits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$train
  [1]   1   2   3   4   5   8   9  10  11  12  14  18  19  20  21  22  23  24
 [19]  25  27  28  29  30  31  32  34  35  36  37  38  39  40  41  42  43  44
 [37]  46  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64
 [55]  65  66  69  70  71  72  77  78  79  80  81  82  83  85  86  88  89  90
 [73]  91  92  93  94  97  98  99 100 101 103 104 105 106 107 108 109 110 111
 [91] 112 113 114 116 117 118 119 120 121 122 123 124 125 128 129 130 132 133
[109] 135 136 137 138 139 140 142 143 144 145 146 148 149 151 152 153 157 158
[127] 159 160 161 162 163 164 165 166 167 169 170 171 173 174 175 177 178 179
[145] 180 181 182 183 184 185 186 187 188 189 190 191 194 195 196 197 198 199
[163] 200 201 202 203 204 205 206 207 209 210 212 213 215 216 217 218 220 221
[181] 222 224 225 226 228 229 231 233 234 235 236 237 238 243 244 245 246 247
[199] 248 251 252 255 256 257 258 259 261 262 263 264 266 267 268 269 270 271
[217] 273 275 276 277 279 280 281 282 283 284 285 286 287 290 291 292 293 294
[235] 295 297 298 299 301 302 305 306 307 309 310 311 312 313 314 315 316 318
[253] 319 320 321 322 324 326 327 328 329 330 331 332 333 334 335 336 337 339
[271] 340 341 343 344 346 347 349 350 351 352 353 354 355 356 357 358 359 360
[289] 361 364 365 366 367 368 369 370 371 372 373 374 375 376 378 379 380 381
[307] 382 384 386 387 389 390 391 392 393 394 395 396 397 398 399 401 402 403
[325] 404 405 406 407 408 409 410 411 412 414 415 416 417 418 420 421 422 423
[343] 424 425 427 429 430 433 436 437 439 440 441 442 443 444 445 446 447 448
[361] 449 450 451 452 453 454 455 456 457 459 461 463 464 465 466 469 470 471
[379] 472 473 474 476 477 478 482 483 484 485 486 487 488 489 490 491 493 494
[397] 495 497 498 499 500 501 503 504 505 506 508 509 510 511 512 513 514 515
[415] 516 517 518 520 521 522 523 524 526 527 528 529 530 532 533 534 535 536
[433] 537 538 539 542 543 544 545 548 549 550 551 552 553 554 555 556 557 560
[451] 562 563 564 565 566 568 569 570 572 573 574 575 576 578 579 580 581 582
[469] 583 584 585 586 588 589 590 591 592 594 595 596 597 598 600 601 602 603
[487] 604 605 606 607 608 609 610 611 612 615 616 617 618 619 620 621 623 625
[505] 627 628 629 630 632 634 635 636 637 639 640 641 642 643 644 645 646 647
[523] 649 650 651 654 656 658 659 660 661 662 663 665 666 667 669 670 672 674
[541] 676 677 678 681 683 684 686 687 688 689 690 692 693 695 697 698 700 701
[559] 702 703 704 705 706 707 708 709 710 711 712 713 714 715 716 717 722 723
[577] 724 725 726 727 728 729 730 732 735 736 737 738 739 740 741 742 743 744
[595] 746 748 749 750 751 752 753 754 756 757 758 759 760 761 762 763 764 765
[613] 766 767

$test
  [1]   6   7  13  15  16  17  26  33  45  47  67  68  73  74  75  76  84  87
 [19]  95  96 102 115 126 127 131 134 141 147 150 154 155 156 168 172 176 192
 [37] 193 208 211 214 219 223 227 230 232 239 240 241 242 249 250 253 254 260
 [55] 265 272 274 278 288 289 296 300 303 304 308 317 323 325 338 342 345 348
 [73] 362 363 377 383 385 388 400 413 419 426 428 431 432 434 435 438 458 460
 [91] 462 467 468 475 479 480 481 492 496 502 507 519 525 531 540 541 546 547
[109] 558 559 561 567 571 577 587 593 599 613 614 622 624 626 631 633 638 648
[127] 652 653 655 657 664 668 671 673 675 679 680 682 685 691 694 696 699 718
[145] 719 720 721 731 733 734 745 747 755 768

$validation
integer(0)</code></pre>
</div>
</div>
</section>
<section id="training-the-model" class="level4">
<h4 class="anchored" data-anchor-id="training-the-model">Training the model</h4>
<p>Now, I will train the classification tree on the training data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading the learners</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lrn_featureless <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.featureless"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>) <span class="co"># 'prob' is the default prediction type</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>lrn_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerClassifRpart:classif.rpart&gt;: Classification Tree
* Model: -
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  response, [prob]
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, multiclass, selected_features,
  twoclass, weights</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># training the learners</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">train</span>(tsk_pima, splits<span class="sc">$</span>train)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_pima, splits<span class="sc">$</span>train)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>lrn_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerClassifRpart:classif.rpart&gt;: Classification Tree
* Model: rpart
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  response, [prob]
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, multiclass, selected_features,
  twoclass, weights</code></pre>
</div>
</div>
</section>
<section id="sec-question-one-evaluating" class="level4">
<h4 class="anchored" data-anchor-id="sec-question-one-evaluating">Evaluating the model</h4>
<p>Here, I’m evaluating the model on the test data (and comparing against the featureless learner).</p>
<p>I will consider the Brier, log-loss and accuracy <code>measures</code>. The <a href="https://en.wikipedia.org/wiki/Brier_score">Brier score</a> lies between <span class="math inline">\([0,
1]\)</span>, where <span class="math inline">\(0\)</span> is best. The log-loss is the negative logarithm of the predicted probability for the true class, and the accuracy is the number of correct predictions divided by total number of predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load accuracy measures</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.mbrier"</span>, <span class="st">"classif.logloss"</span>, <span class="st">"classif.acc"</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predicting using the featureless learner</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>prediction_featureless <span class="ot">&lt;-</span> lrn_featureless<span class="sc">$</span><span class="fu">predict</span>(tsk_pima, splits<span class="sc">$</span>test)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>prediction_featureless </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 154 observations:
 row_ids truth response  prob.pos  prob.neg
       6   neg      neg 0.3485342 0.6514658
       7   pos      neg 0.3485342 0.6514658
      13   neg      neg 0.3485342 0.6514658
     ---   ---      ---       ---       ---
     747   pos      neg 0.3485342 0.6514658
     755   pos      neg 0.3485342 0.6514658
     768   neg      neg 0.3485342 0.6514658</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtaining score of featureless learner</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>prediction_featureless<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> classif.mbrier classif.logloss     classif.acc 
      0.4553977       0.6478575       0.6493506 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predicting using the classification tree</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>prediction_rpart <span class="ot">&lt;-</span> lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_pima, splits<span class="sc">$</span>test)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>prediction_rpart </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 154 observations:
 row_ids truth response   prob.pos  prob.neg
       6   neg      neg 0.00000000 1.0000000
       7   pos      neg 0.08675799 0.9132420
      13   neg      neg 0.24390244 0.7560976
     ---   ---      ---        ---       ---
     747   pos      pos 0.77777778 0.2222222
     755   pos      pos 0.76744186 0.2325581
     768   neg      neg 0.08675799 0.9132420</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtaining score of the classification tree</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span><span class="fu">score</span>(measures) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> classif.mbrier classif.logloss     classif.acc 
      0.2763229       0.8516860       0.8246753 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1">1</button><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span>confusion</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="2" data-code-annotation="1">All off-diagonal entries are incorrectly classified observations, and all diagonal entries are correctly classified.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response pos neg
     pos  40  13
     neg  14  87</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>prediction_plot <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(prediction_rpart) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Default"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>prediction_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="question-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<p>Calculate the true positive, false positive, true negative, and false negative rates of the predictions made by the model in Exercise 1.</p>
<ul>
<li>Try to solve this in two ways:
<ol type="1">
<li>Using <code>mlr3measures</code>-predefined measure objects.</li>
<li>Without using <code>mlr3</code> tools by directly working on the ground truth and prediction vectors.</li>
</ol></li>
<li>Compare the results.</li>
</ul>
<section id="answer-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="answer-1">Answer</h3>
<p>I’ve already started this in Question 1 (<a href="#sec-question-one-evaluating" class="quarto-xref">Section&nbsp;2.1.1.4</a>), but I will reiterate here. The confusion matrix gives the number of predictions that are correct (true positives or negatives) on the diagonal, and those that are incorrect (false positives and negatives) on the top right and bottom left, respectively</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> prediction_rpart<span class="sc">$</span>confusion</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>conf_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response pos neg
     pos  40  13
     neg  14  87</code></pre>
</div>
</div>
<p>I want to obtain the <em>rates</em>, both using the <a href="https://mlr3.mlr-org.com/reference/mlr_measures.html"><code>mlr3measures</code></a> objects, and without.</p>

<div class="no-row-height column-margin column-container"><div class="">
<dl>
<dt>Sensitivity</dt>
<dd>
(true positive rate) is the probability of a positive test result, conditioned on the individual truly being positive.
</dd>
<dt>Specificity</dt>
<dd>
(true negative rate) is the probability of a negative test result, conditioned on the individual truly being negative.
</dd>
</dl>
</div></div><section id="using-mlr3measures" class="level4">
<h4 class="anchored" data-anchor-id="using-mlr3measures">Using <code>mlr3measures</code></h4>
<p>First, let’s figure out the measures we need…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_measures)[task_type <span class="sc">==</span> <span class="st">"classif"</span> <span class="sc">&amp;</span> predict_type <span class="sc">==</span> <span class="st">"response"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;key&gt;
                    key                         label task_type
                 &lt;char&gt;                        &lt;char&gt;    &lt;char&gt;
 1:         classif.acc       Classification Accuracy   classif
 2:        classif.bacc             Balanced Accuracy   classif
 3:          classif.ce          Classification Error   classif
 4:       classif.costs Cost-sensitive Classification   classif
 5:         classif.dor         Diagnostic Odds Ratio   classif
---                                                            
19: classif.specificity                   Specificity   classif
20:          classif.tn                True Negatives   classif
21:         classif.tnr            True Negative Rate   classif
22:          classif.tp                True Positives   classif
23:         classif.tpr            True Positive Rate   classif
             packages predict_type properties task_properties
               &lt;list&gt;       &lt;char&gt;     &lt;list&gt;          &lt;list&gt;
 1: mlr3,mlr3measures     response                           
 2: mlr3,mlr3measures     response                           
 3: mlr3,mlr3measures     response                           
 4:              mlr3     response                           
 5: mlr3,mlr3measures     response                   twoclass
---                                                          
19: mlr3,mlr3measures     response                   twoclass
20: mlr3,mlr3measures     response                   twoclass
21: mlr3,mlr3measures     response                   twoclass
22: mlr3,mlr3measures     response                   twoclass
23: mlr3,mlr3measures     response                   twoclass</code></pre>
</div>
</div>
<p>OK, so we need to use the measures <code>classif.tpr</code> <code>classif.fpr</code> <code>classif.tnr</code> and <code>classif.fnr</code>, for the true positive, false positive, true negative and false negative rates, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">&lt;-</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.tpr"</span>, <span class="st">"classif.fpr"</span>, <span class="st">"classif.tnr"</span>, <span class="st">"classif.fnr"</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.tpr classif.fpr classif.tnr classif.fnr 
  0.7407407   0.1300000   0.8700000   0.2592593 </code></pre>
</div>
</div>
</section>
<section id="without-using-mlr3measures" class="level4">
<h4 class="anchored" data-anchor-id="without-using-mlr3measures">Without using <code>mlr3measures</code></h4>
<p>I can obtain these rates directly from the confusion matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(conf_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'table' int [1:2, 1:2] 40 14 13 87
 - attr(*, "dimnames")=List of 2
  ..$ response: chr [1:2] "pos" "neg"
  ..$ truth   : chr [1:2] "pos" "neg"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># true positive rate / sensitivity</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>tpr <span class="ot">&lt;-</span> conf_matrix[<span class="dv">1</span>, <span class="dv">1</span>]<span class="sc">/</span> <span class="fu">sum</span>(conf_matrix[, <span class="dv">1</span>])</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># false positive rate</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>fpr <span class="ot">&lt;-</span> conf_matrix[<span class="dv">1</span>, <span class="dv">2</span>]<span class="sc">/</span> <span class="fu">sum</span>(conf_matrix[, <span class="dv">2</span>])</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># true negative rate / specificity</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>tnr <span class="ot">&lt;-</span> conf_matrix[<span class="dv">2</span>, <span class="dv">2</span>]<span class="sc">/</span> <span class="fu">sum</span>(conf_matrix[, <span class="dv">2</span>])</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># false negative rate</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>fnr <span class="ot">&lt;-</span> conf_matrix[<span class="dv">2</span>, <span class="dv">1</span>]<span class="sc">/</span> <span class="fu">sum</span>(conf_matrix[, <span class="dv">1</span>])</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data.table</span>(</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">classif.tpr =</span> tpr,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">classif.fpr =</span> fpr,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">classif.tnr =</span> tnr,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">classif.fnr =</span> fnr</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.tpr classif.fpr classif.tnr classif.fnr
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
1:   0.7407407        0.13        0.87   0.2592593</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<p>Change the threshold of the model from Question 1 such that the false positive rate is lower than the false negative rate.</p>
<ul>
<li>What is one reason you might do this in practice?</li>
</ul>
<section id="answer-2" class="level3">
<h3 class="anchored" data-anchor-id="answer-2">Answer</h3>
<p>One reason I might want a lower false positive rate than false negative rate is it the damage done by a false positive is higher than that done by a false negative. That if, if classifying the outcome as positive when it is actually negative is more damaging than the other way round. For example, if I am building a model to predict fraud for a bank, and a false positive would result in a customer transaction being wrongly declined. Lots of false positives could result in annoyed customers and a loss of trust.</p>
<section id="inverse-weights" class="level4">
<h4 class="anchored" data-anchor-id="inverse-weights">Inverse weights</h4>
<p>Let’s first change the thresholds such that they account for the inbalanced data. I’m not considering false positives here.</p>
<p>From <a href="#fig-pima-pairs" class="quarto-xref">Figure&nbsp;1</a>, it’s clear that the data is unbalanced (more people with negative diabetes than positive). I can account for this by changing the thresholds using inverse weightings.</p>
<p>First, let’s use the training data to obtain new thresholds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>new_thresh <span class="ot">=</span> <span class="fu">proportions</span>(<span class="fu">table</span>(tsk_pima<span class="sc">$</span><span class="fu">truth</span>(splits<span class="sc">$</span>train)))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>new_thresh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      pos       neg 
0.3485342 0.6514658 </code></pre>
</div>
</div>
<p>And then I’ll use these thresholds to reweight the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span><span class="fu">set_threshold</span>(new_thresh)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span>confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response pos neg
     pos  40  13
     neg  14  87</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>prediction_plot_newt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(prediction_rpart) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ggtitle</span>(<span class="st">"Inverse weighting thresholds"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>prediction_plot <span class="sc">+</span> prediction_plot_newt <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Oh, it doesn’t make a difference!</p>
</section>
<section id="reducing-false-positive-rate" class="level4">
<h4 class="anchored" data-anchor-id="reducing-false-positive-rate">Reducing false positive rate</h4>
<p>This can be achieved by making it more difficult for the model to predict a positive result.</p>
<p>So, let’s create thresholds where the <code>pos</code> result is penalised.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>new_thresh <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pos"</span> <span class="ot">=</span> <span class="fl">0.7</span>, <span class="st">"neg"</span> <span class="ot">=</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span><span class="fu">set_threshold</span>(new_thresh)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span>confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response pos neg
     pos  35  10
     neg  19  90</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">&lt;-</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.tpr"</span>, <span class="st">"classif.fpr"</span>, <span class="st">"classif.tnr"</span>, <span class="st">"classif.fnr"</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>prediction_rpart<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.tpr classif.fpr classif.tnr classif.fnr 
  0.6481481   0.1000000   0.9000000   0.3518519 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>prediction_plot_newt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(prediction_rpart) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ggtitle</span>(<span class="st">"New thresholds"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>prediction_plot <span class="sc">+</span> prediction_plot_newt <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, the false positive rate has decreased, but the false negative has increased (as expected).</p>
</section>
</section>
</section>
</section>
<section id="fin" class="level1">
<h1>Fin</h1>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smith2025,
  author = {Smith, Paul and Smith, Paul},
  title = {Getting {Started} with \{Mlr3\}},
  date = {2025-03-03},
  url = {https://pws3141.github.io/blog/posts/05-mlr3_basic_modelling/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smith2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Smith, Paul, and Paul Smith. 2025. <span>“Getting Started with
{Mlr3}.”</span> March 3, 2025. <a href="https://pws3141.github.io/blog/posts/05-mlr3_basic_modelling/">https://pws3141.github.io/blog/posts/05-mlr3_basic_modelling/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pws3141\.github\.io\/blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>