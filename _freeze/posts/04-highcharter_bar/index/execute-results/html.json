{
  "hash": "355240c843d3340f009a07d6ce654f11",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"A Bidirectional Bar Chart using Highcharter\"\nauthor: \"Paul Smith\"\ndate: \"2025-02-19\"\ncategories: [code, graphics, r]\nimage: \"./fig/highcharter_logo.png\"\nexecute:\n  df-print: default\n---\n\n\n\nThis is just a quick post, as a follow on to my previous highcharter posts ([one](../01-highcharter/index.qmd) and [two](../01-highcharter/index.qmd)).\n\nI wanted a bar chart that looks like @fig-example, which was made using [Flourish](https://flourish.studio/).\n\n![A bidirectional bar chart created using Flourish](./fig/flourish_example.png){#fig-example}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nlibrary(highcharter)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nHighcharts (www.highcharts.com) is a Highsoft software product which is\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nnot free for commercial and Governmental use\n```\n\n\n:::\n:::\n\n\n\n:::{.column-margin}\nOn a separate note, I've started preferring `data.table` over the tidyverse. It is super fast, and feels like the syntax is very well thought out. It also allows me to start experimenting with [`{mlr3}`](https://mlr3.mlr-org.com/).\n:::\n\n## The data\n\nThe data looks like this.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbar_data <- data.table(\n  donation_and_transplantation_summary = c(\n    \"Waiting for an organ\",\n    \"Opt-Out from the ODR\",\n    \"Deceased organ donor transplants\",\n    \"Died on the waiting list\",\n    \"Living organ donor transplants\",\n    \"Living donors\",\n    \"Opt-in to the Organ Donor Register (ODR)\",\n    \"Eligible deceased donors\",\n    \"Deceased donors\"\n  ),\n  black_percent = c(-11, -7, -10, -8, -4, -3, -2, -3, -1),\n  asian_percent = c(19, 18, 17, 13, 9, 8, 7, 7, 4)\n)\n\nbar_data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       donation_and_transplantation_summary black_percent asian_percent\n                                     <char>         <num>         <num>\n1:                     Waiting for an organ           -11            19\n2:                     Opt-Out from the ODR            -7            18\n3:         Deceased organ donor transplants           -10            17\n4:                 Died on the waiting list            -8            13\n5:           Living organ donor transplants            -4             9\n6:                            Living donors            -3             8\n7: Opt-in to the Organ Donor Register (ODR)            -2             7\n8:                 Eligible deceased donors            -3             7\n9:                          Deceased donors            -1             4\n```\n\n\n:::\n:::\n\n\n\n## The chart\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhighchart() |>\n  # Set the chart type\n  hc_chart(type = \"bar\") |>\n  # Provide x-axis categories (the labels for each bar)\n  hc_xAxis(\n    list(\n      categories = bar_data$donation_and_transplantation_summary,\n      reversed = FALSE\n    )\n    #list( # mirror axis on right side\n    #  opposite = TRUE,\n    #  categories = bar_data$donation_and_transplantation_summary,\n    #  reversed = FALSE,\n    #  linkedTo = 0\n    #  )\n    ) |>\n  hc_yAxis(\n    gridLineColor = \"#f2f5f3\",\n    labels = list(\n      # positive values on both sides, appended with '%'\n      formatter = JS(\"function() { return Math.abs(this.value) + '%'; }\")\n    ),\n    plotBands = list( \n      list(\n      color = '#e2e1e1', from = 0, to = 9,\n      label = list(\n        text = \"9% Asian population\",\n        align = 'left',\n        y = -1,\n        x = 10\n        )\n      ),\n      list(\n      color = '#e2e1e1', from = -4, to = 0,\n      label = list(\n        text = \"4% Black population\",\n        align = 'right',\n        y = -1\n        )      \n      )\n    )\n  ) |>\n  hc_plotOptions(\n    series = list(\n      # put bars for the same category on the same line\n      stacking = \"normal\",\n      pointPadding = 0.01,  # Padding between each column or bar, in x axis units... Defaults to 0.1.\n      groupPadding = 0.05  # Padding between each value groups, in x axis units... Defaults to 0.2.\n    )\n  ) |>\n  hc_title(\n    text = \"<span style='color:#62b19c;'>Black</span> and \n            <span style='color:#bd82d5;'>Asian</span> \n            ethnic minorities are over-represented in transplant statistics\",\n    useHTML = TRUE,\n    style = list(\n      fontWeight = 'bold'\n    ),\n    align = \"left\"\n  )  |>\n  hc_subtitle(\n    text = \"Percentage of these groups relative to the population of England and Wales in 2023/24\",\n    align = 'left'\n  ) |>\n  hc_credits(\n    enabled = TRUE,\n    text = \"Ethnicity Differences in Organ Donation and Transplantion report for 2023/24 and 2021 population census estimates.\",\n    href = \"https://www.odt.nhs.uk/statistics-and-reports/annual-report-on-ethnicity-differences/\"  \n    ) |>\n  hc_annotations(\n    list(\n        draggable = '',\n        labelOptions = list(\n          shape = 'connector',\n          justify = FALSE,\n          crop = TRUE,\n          style = list(\n            fontSize = \"10px\",\n            textOutline = \"1px white\",\n            fontWeight = \"normal\",\n            color = \"#4a4a4a\" \n            )\n        ),\n        labels =\n          list(point = list(xAxis = 0, yAxis = 0, y = 9, x = 6.5),\n               text = \"Within the grey zone shows<br>under-representation, while<br>outside the grey zone indicates<br>over-representation compared<br>to the population of England<br>and Wales.\",\n               x = 100, # offset in pixels\n               y = 50\n               )\n    )\n  ) |>\n  hc_legend(\n    align = \"right\",\n    verticalAlign = \"bottom\",\n    layout = \"horizontal\"\n  ) |>\n  hc_tooltip(\n    formatter = JS(\n      \"function() {\n         return '<b>' + this.series.name + '</b><br/>' +\n                this.point.category + ': ' +\n                Highcharts.numberFormat(Math.abs(this.point.y), 0) + '%';\n       }\"\n    )\n  ) |>\n  hc_exporting(\n    accessibility = list(\n      enabled = TRUE # default value is TRUE\n      ),\n    enabled = TRUE,\n    filename = \"ethnic_minority_bar\"\n  ) |>\n  hc_plotOptions(\n    accessibility = list(\n      enabled = TRUE,\n      keyboardNavigation = list(enabled = TRUE)\n      )\n    ) |>\n  # Add a series of numeric values for the bars\n  hc_add_series(\n    name = \"Asian population\",\n    data = bar_data$asian_percent,\n    color = '#bd82d5'\n  ) |>\n  hc_add_series(\n    name = \"Black population\",\n    data = bar_data$black_percent,\n    color = '#62b19c'\n  ) \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"highchart html-widget html-fill-item\" id=\"htmlwidget-3fbc2b0b103a01a67068\" style=\"width:100%;height:520px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3fbc2b0b103a01a67068\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true,\"type\":\"bar\"},\"title\":{\"text\":\"<span style='color:#62b19c;'>Black<\\/span> and \\n            <span style='color:#bd82d5;'>Asian<\\/span> \\n            ethnic minorities are over-represented in transplant statistics\",\"useHTML\":true,\"style\":{\"fontWeight\":\"bold\"},\"align\":\"left\"},\"yAxis\":{\"title\":{\"text\":null},\"gridLineColor\":\"#f2f5f3\",\"labels\":{\"formatter\":\"function() { return Math.abs(this.value) + '%'; }\"},\"plotBands\":[{\"color\":\"#e2e1e1\",\"from\":0,\"to\":9,\"label\":{\"text\":\"9% Asian population\",\"align\":\"left\",\"y\":-1,\"x\":10}},{\"color\":\"#e2e1e1\",\"from\":-4,\"to\":0,\"label\":{\"text\":\"4% Black population\",\"align\":\"right\",\"y\":-1}}]},\"credits\":{\"enabled\":true,\"text\":\"Ethnicity Differences in Organ Donation and Transplantion report for 2023/24 and 2021 population census estimates.\",\"href\":\"https://www.odt.nhs.uk/statistics-and-reports/annual-report-on-ethnicity-differences/\"},\"exporting\":{\"enabled\":true,\"accessibility\":{\"enabled\":true},\"filename\":\"ethnic_minority_bar\"},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0,\"stacking\":\"normal\",\"pointPadding\":0.01,\"groupPadding\":0.05},\"treemap\":{\"layoutAlgorithm\":\"squarified\"},\"accessibility\":{\"enabled\":true,\"keyboardNavigation\":{\"enabled\":true}}},\"xAxis\":[{\"categories\":[\"Waiting for an organ\",\"Opt-Out from the ODR\",\"Deceased organ donor transplants\",\"Died on the waiting list\",\"Living organ donor transplants\",\"Living donors\",\"Opt-in to the Organ Donor Register (ODR)\",\"Eligible deceased donors\",\"Deceased donors\"],\"reversed\":false}],\"subtitle\":{\"text\":\"Percentage of these groups relative to the population of England and Wales in 2023/24\",\"align\":\"left\"},\"annotations\":[{\"draggable\":\"\",\"labelOptions\":{\"shape\":\"connector\",\"justify\":false,\"crop\":true,\"style\":{\"fontSize\":\"10px\",\"textOutline\":\"1px white\",\"fontWeight\":\"normal\",\"color\":\"#4a4a4a\"}},\"labels\":{\"point\":{\"xAxis\":0,\"yAxis\":0,\"y\":9,\"x\":6.5},\"text\":\"Within the grey zone shows<br>under-representation, while<br>outside the grey zone indicates<br>over-representation compared<br>to the population of England<br>and Wales.\",\"x\":100,\"y\":50}}],\"legend\":{\"align\":\"right\",\"verticalAlign\":\"bottom\",\"layout\":\"horizontal\"},\"tooltip\":{\"formatter\":\"function() {\\n         return '<b>' + this.series.name + '<\\/b><br/>' +\\n                this.point.category + ': ' +\\n                Highcharts.numberFormat(Math.abs(this.point.y), 0) + '%';\\n       }\"},\"series\":[{\"data\":[19,18,17,13,9,8,7,7,4],\"name\":\"Asian population\",\"color\":\"#bd82d5\"},{\"data\":[-11,-7,-10,-8,-4,-3,-2,-3,-1],\"name\":\"Black population\",\"color\":\"#62b19c\"}]},\"theme\":{\"chart\":{\"backgroundColor\":\"transparent\"},\"colors\":[\"#7cb5ec\",\"#434348\",\"#90ed7d\",\"#f7a35c\",\"#8085e9\",\"#f15c80\",\"#e4d354\",\"#2b908f\",\"#f45b5b\",\"#91e8e1\"]},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"chart\",\"fonts\":[],\"debug\":false},\"evals\":[\"hc_opts.yAxis.labels.formatter\",\"hc_opts.tooltip.formatter\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\nI think the end result is pretty good.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<script src=\"../../site_libs/proj4js-2.3.15/proj4.js\"></script>\n<link href=\"../../site_libs/highcharts-9.3.1/css/motion.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/highcharts-9.3.1/highcharts.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/highcharts-3d.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/highcharts-more.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/stock.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/map.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/accessibility.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/data.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/exporting.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/offline-exporting.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/drilldown.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/item-series.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/overlapping-datalabels.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/annotations.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/export-data.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/funnel.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/heatmap.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/treemap.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/sankey.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/dependency-wheel.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/organization.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/solid-gauge.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/streamgraph.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/sunburst.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/vector.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/wordcloud.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/xrange.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/tilemap.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/venn.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/gantt.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/timeline.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/parallel-coordinates.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/bullet.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/coloraxis.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/dumbbell.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/lollipop.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/series-label.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/plugins/motion.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/custom/reset.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/boost.js\"></script>\n<script src=\"../../site_libs/highchart-binding-0.9.4/highchart.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}